import asyncio
import logging
import os
from datetime import datetime
from dotenv import load_dotenv
import asyncpg
from aiogram import Bot, Dispatcher, types
from aiogram.filters import CommandStart
from aiogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton, ReplyKeyboardMarkup, KeyboardButton
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import State, StatesGroup

load_dotenv()

BOT_TOKEN = os.getenv('BOT_TOKEN')
DATABASE_URL = os.getenv('DATABASE_URL')
CHANNEL_LINK = "—Å—Å—ã–ª–∫–∞"  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞–Ω–∞–ª
ELENA_CONTACT = "@Lebedeva_Elen"
ADMIN_CHAT_ID = 269435099  # chat_id –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

bot = Bot(token=BOT_TOKEN)
dp = Dispatcher()

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä
from test_module import test_router

# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
async def get_db_connection():
    try:
        return await asyncpg.connect(DATABASE_URL)
    except Exception as e:
        logging.error(f"Database connection error: {e}")
        return None

async def init_database():
    """–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞"""
    conn = await get_db_connection()
    if not conn:
        return

    try:
        # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        await conn.execute('''
            CREATE TABLE IF NOT EXISTS mss_users (
                id SERIAL PRIMARY KEY,
                user_id BIGINT UNIQUE NOT NULL,
                username VARCHAR(255),
                first_name VARCHAR(255),
                last_name VARCHAR(255),
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                last_activity TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        ''')

        # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–æ–±—â–µ–Ω–∏–π
        await conn.execute('''
            CREATE TABLE IF NOT EXISTS mss_chat (
                id SERIAL PRIMARY KEY,
                user_id BIGINT NOT NULL,
                username VARCHAR(255),
                message_text TEXT,
                message_type VARCHAR(100),
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        ''')

        logging.info("Database tables initialized successfully")

    except Exception as e:
        logging.error(f"Database initialization error: {e}")
    finally:
        await conn.close()

async def add_user_to_db(user: types.User):
    """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î"""
    conn = await get_db_connection()
    if not conn:
        return

    try:
        await conn.execute('''
            INSERT INTO mss_users (user_id, username, first_name, last_name, last_activity)
            VALUES ($1, $2, $3, $4, $5)
            ON CONFLICT (user_id)
            DO UPDATE SET
                username = EXCLUDED.username,
                first_name = EXCLUDED.first_name,
                last_name = EXCLUDED.last_name,
                last_activity = EXCLUDED.last_activity
        ''', user.id, user.username, user.first_name, user.last_name, datetime.now())

    except Exception as e:
        logging.error(f"Error adding user to database: {e}")
    finally:
        await conn.close()

async def log_message_to_db(user: types.User, message_text: str, message_type: str = "text"):
    """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ë–î"""
    conn = await get_db_connection()
    if not conn:
        return

    try:
        await conn.execute('''
            INSERT INTO mss_chat (user_id, username, message_text, message_type)
            VALUES ($1, $2, $3, $4)
        ''', user.id, user.username, message_text, message_type)

    except Exception as e:
        logging.error(f"Error logging message to database: {e}")
    finally:
        await conn.close()

def get_main_keyboard():
    return ReplyKeyboardMarkup(keyboard=[
        [KeyboardButton(text="üìö –£–∑–Ω–∞—Ç—å –æ –∫—É—Ä—Å–µ"), KeyboardButton(text="üë• –î–ª—è –∫–∞–∫–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞")],
        [KeyboardButton(text="üìã –§–æ—Ä–º–∞—Ç –∑–∞–Ω—è—Ç–∏–π"), KeyboardButton(text="üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫—É—Ä—Å–∞")],
        [KeyboardButton(text="‚è∞ –ö–∞–∫ –ø—Ä–æ—Ö–æ–¥—è—Ç –∑–∞–Ω—è—Ç–∏—è"), KeyboardButton(text="üí∞ –û–ø–ª–∞—Ç–∞")],
        [KeyboardButton(text="üÜò –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π"), KeyboardButton(text="üß© –ú–∏–Ω–∏ —Ç–µ—Å—Ç")]
    ], resize_keyboard=True)

def get_support_keyboard():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üÜò –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π", callback_data="support")]
    ])

class SupportStates(StatesGroup):
    waiting_for_question = State()

@dp.message(CommandStart())
async def start_handler(message: Message):
    # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
    await add_user_to_db(message.from_user)

    # –õ–æ–≥–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—É /start
    await log_message_to_db(message.from_user, "/start", "command")

    welcome_text = f"""–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!

–Ø ‚Äì –ï–ª–µ–Ω–∞ –õ–µ–±–µ–¥–µ–≤–∞, –∞ —ç—Ç–æ ‚Äì –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –±–æ—Ç –∫—É—Ä—Å–∞ "–ò–∑–ª–∞–≥–∞–π —è—Å–Ω–æ" –¥–ª—è –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤ –∏ –≤–∑—Ä–æ—Å–ª—ã—Ö.

–ó–¥–µ—Å—å —è —Ä–∞—Å—Å–∫–∞–∂—É –≤–∞–º –ø–æ–¥—Ä–æ–±–Ω–æ –æ —Å–∞–º–æ–º –∫—É—Ä—Å–µ –∏ –µ–≥–æ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è—Ö.

–ß—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å—Å—è, –ø–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ –º–æ–π –∫–∞–Ω–∞–ª {CHANNEL_LINK}

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É ¬´–°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π¬ª."""

    await message.answer(welcome_text, reply_markup=get_main_keyboard())

@dp.message(lambda message: message.text == "üìö –£–∑–Ω–∞—Ç—å –æ –∫—É—Ä—Å–µ")
async def handle_about_course(message: Message):
    await add_user_to_db(message.from_user)
    await log_message_to_db(message.from_user, message.text, "menu_button")
    course_text = """üìö –£–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –∫—É—Ä—Å–µ "–ò–∑–ª–∞–≥–∞–π —è—Å–Ω–æ"

–ö—É—Ä—Å –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é —É—Å—Ç–Ω–æ–π –∏ –ø–∏—Å—å–º–µ–Ω–Ω–æ–π —Ä–µ—á–∏.

–ö—É—Ä—Å –ø–æ–¥–æ–π–¥–µ—Ç –≤–∞–º, –µ—Å–ª–∏ –≤—ã –∑–∞–¥–∞–µ—Ç–µ—Å—å –≤–æ–ø—Ä–æ—Å–∞–º–∏:
‚Ä¢ –ö–∞–∫ –Ω–∞—É—á–∏—Ç—å —Ä–µ–±–µ–Ω–∫–∞ –ø–∏—Å–∞—Ç—å?
‚Ä¢ –ß—Ç–æ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤–æ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–∏, –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Å—Ç–∏, –≤ –∑–∞–∫–ª—é—á–µ–Ω–∏–∏
‚Ä¢ –ö–∞–∫ –ø—Ä–µ–æ–¥–æ–ª–µ—Ç—å —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö –ø–∏—Å—å–º–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç
‚Ä¢ –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –ª—é–±–∞—è –ø–∏—Å—å–º–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤–≤–µ—Ä–≥–∞–µ—Ç –≤ —É–Ω—ã–Ω–∏–µ
‚Ä¢ –ö–∞–∫ –ø–æ–º–æ—á—å —Ä–µ–±–µ–Ω–∫—É –æ—Ñ–æ—Ä–º–∏—Ç—å —Å–≤–æ–∏ –º—ã—Å–ª–∏ –ø–∏—Å—å–º–µ–Ω–Ω–æ, —Ö–æ—Ç—è –Ω–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —á—Ç–æ-—Ç–æ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å
‚Ä¢ –ö–∞–∫ –Ω–µ –±–æ—è—Ç—Å—è –≤—ã—Ä–∞–∂–∞—Ç—å —Å–≤–æ–∏ –º—ã—Å–ª–∏ –Ω–∞ –±—É–º–∞–≥–µ

–ù–∞ –∫—É—Ä—Å–µ "–ò–∑–ª–∞–≥–∞–π —è—Å–Ω–æ" —Ä–µ–±–µ–Ω–æ–∫, –∞ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –∏ —Ä–æ–¥–∏—Ç–µ–ª—å,
üìù –æ—Å–≤–æ–∏—Ç –∞–ª–≥–æ—Ä–∏—Ç–º —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤
üìñ —Ä–∞—Å—à–∏—Ä–∏—Ç —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å
üé§ –æ—Ç—Ç–æ—á–∏—Ç –∏—Å–∫—É—Å—Å—Ç–≤–æ –ø–µ—Ä–µ—Å–∫–∞–∑–∞
‚úçÔ∏è –Ω–∞—É—á–∏—Ç—Å—è –ø—Ä–∏–º–µ–Ω—è—Ç—å —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏
üîç –ø–æ–π–º–µ—Ç, –∫–∞–∫ –≤—ã–¥–µ–ª—è—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏ –∏–¥–µ–∏ –≤ —Ç–µ–∫—Å—Ç–µ
üìÑ –Ω–∞–ø–∏—à–µ—Ç 20 —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤

–ö—É—Ä—Å –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è:

‚Äî 9 –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
‚Äî 24 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–Ω—è—Ç–∏–π
‚Äî 20 —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–ø–∏—à–µ—Ç —É—á–µ–Ω–∏–∫
‚Äî –°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –≤ —á–∞—Ç–µ –≤ —Ç–µ—á–µ–Ω–∏–µ –≤—Å–µ–≥–æ –∫—É—Ä—Å–∞ (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –∫ –∑–∞–¥–∞–Ω–∏—è–º, –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã)
‚Äî –ü–æ–ª–µ–∑–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–æ—Å—Ç–∞—é—Ç—Å—è —É –≤–∞—Å –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫—É—Ä—Å–∞)

üìå –í—Å–µ –ø—Ä–æ–¥—É–º–∞–Ω–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∞ —Ç–∞–∫–∂–µ –º–∞–∫—Å–∏–º—É–º –ø–æ–ª—å–∑—ã –æ—Ç –æ–±—â–µ–Ω–∏—è —Å –≤–µ–¥—É—â–∏–º –∏ ¬´—Å–æ–∫—É—Ä—Å–Ω–∏–∫–∞–º–∏¬ª."""

    await message.answer(course_text)

@dp.message(lambda message: message.text == "üë• –î–ª—è –∫–∞–∫–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞")
async def handle_age_info(message: Message):
    await add_user_to_db(message.from_user)
    await log_message_to_db(message.from_user, message.text, "menu_button")
    age_text = """üë• –î–ª—è –∫–∞–∫–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ –∫—É—Ä—Å?

–ö—É—Ä—Å ¬´–ò–∑–ª–∞–≥–∞–π —è—Å–Ω–æ¬ª –¥–ª—è –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤ 9-16 –ª–µ—Ç.

–ó–∞–¥—É–º—ã–≤–∞–ª–∏—Å—å –ª–∏ –æ —Ç–æ–º, —á—Ç–æ –æ—Ç–ª–∏—á–∞–µ—Ç —É–º–Ω–æ–≥–æ, –ø—Ä–µ—É—Å–ø–µ–≤–∞—é—â–µ–≥–æ –∏ –∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞?

–£–º–µ–Ω–∏–µ —á–µ—Ç–∫–æ –∏ —è—Å–Ω–æ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ –º—ã—Å–ª–∏, –≤—ã–¥–µ–ª—è—Ç—å –≥–ª–∞–≤–Ω–æ–µ –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —ç—Ç–æ—Ç —Å–º—ã—Å–ª –¥—Ä—É–≥–∏–º. –≠—Ç–æ—Ç –Ω–∞–≤—ã–∫ –º–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–∞–Ω–Ω–µ–≥–æ –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ —Å –ø–æ–º–æ—â—å—é –ø–∏—Å—å–º–µ–Ω–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫.

–¢–∞–∫–æ–º—É, –∫–∞–∫ –æ–∫–∞–∑–∞–ª–æ—Å—å, –Ω–µ —É—á–∞—Ç –≤ —à–∫–æ–ª–µ. –ê –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —ç—Ç–æ —É–º–µ–Ω–∏–µ —Å –≤—ã–¥–µ–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –≤ —Ç–µ–∫—Å—Ç–µ, –ø–µ—Ä–µ—Å–∫–∞–∑–∞, –ø–∏—Å—å–º–µ–Ω–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫ ‚Äì –±–∞–∑—ã –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º—ã—Å–ª–µ–π –∏ –∏–∑–ª–æ–∂–µ–Ω–∏—è –∏—Ö –Ω–∞ –±—É–º–∞–≥–µ.

–ö—É—Ä—Å –ø–æ—Å–≤—è—â–µ–Ω –ø–∏—Å–∞—Ç–µ–ª—å—Å–∫–æ–π ¬´–∞–∑–±—É–∫–µ¬ª ‚Äì –æ—Å–Ω–æ–≤–∞–º —Ä–∞–∑–≤–∏—Ç–∏—è –Ω–∞–≤—ã–∫–æ–≤ –ø–∏—Å—å–º–µ–Ω–Ω–æ–π —Ä–µ—á–∏ —É –¥–µ—Ç–µ–π. –£—á–µ–Ω–∏–∫–∏ —Ñ–æ–∫—É—Å–∏—Ä—É—é—Ç—Å—è –Ω–∞ —Ç–æ–º, –ö–ê–ö –ø–∏—Å–∞—Ç—å, –∞ –Ω–µ –Ω–∞ —Ç–æ, –ß–¢–û –ø–∏—Å–∞—Ç—å.

–£—Ä–æ–∫–∏ —Ä–∞–∑–≤–∏—Ç–∏—è –ø–∏—Å—å–º–µ–Ω–Ω–æ–π —Ä–µ—á–∏ ‚Äì —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ –æ—Å–Ω–æ–≤ –∏ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –º—ã—à–ª–µ–Ω–∏—è. –ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫—É—Ä—Å–∞ –∑–∞ –ª—é–±—ã–º–∏ —Ç–µ–∫—Å—Ç–∞–º–∏ —É—á–µ–Ω–∏–∫ –Ω–∞—á–Ω–µ—Ç –≤–∏–¥–µ—Ç—å –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —Ä–∞–∑–ª–∏—á–∞—Ç—å –∂–∞–Ω—Ä—ã, –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ –≤—ã–¥–µ–ª—è—Ç—å –≥–ª–∞–≤–Ω–æ–µ, –≤—ã–¥–µ–ª—è—è —Å—É—Ç—å, –Ω–µ –æ—Ç–≤–ª–µ–∫–∞—è—Å—å –Ω–∞ –¥–µ—Ç–∞–ª–∏ –∏ —É–∫—Ä–∞—à–µ–Ω–∏—è.

–ù–∞ —ç—Ç–æ–º —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–µ —Å—Ç—Ä–æ–∏—Ç—Å—è –≤—Å–µ –∑–¥–∞–Ω–∏–µ –∏—Å–∫—É—Å—Å—Ç–≤–∞ –ø–∏—Å—å–º–∞.

üë∂ –í–æ–∑—Ä–∞—Å—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ö—É—Ä—Å–∞: 9-16 –ª–µ—Ç
ü§ù –†–µ–±—è—Ç–∞–º 9-11 –ª–µ—Ç –∫—É—Ä—Å —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –≤–º–µ—Å—Ç–µ —Å–æ –≤–∑—Ä–æ—Å–ª—ã–º
üéì –†–µ–±—è—Ç–∞ 12-16 –ª–µ—Ç –∏ –≤–∑—Ä–æ—Å–ª—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ

–ö—É—Ä—Å (–¥–æ—Å—Ç—É–ø –Ω–∞ 10 –º–µ—Å—è—Ü–µ–≤) –≤–∫–ª—é—á–∞–µ—Ç:
‚Ä¢ 9 –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
‚Ä¢ 24 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–Ω—è—Ç–∏–π –æ–Ω–ª–∞–π–Ω
‚Ä¢ –°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ —á–∞—Ç–µ
‚Ä¢ 20 —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–ø–∏—à–µ—Ç —É—á–µ–Ω–∏–∫
‚Ä¢ –ü–æ–ª–µ–∑–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã"""

    await message.answer(age_text)

@dp.message(lambda message: message.text == "üìã –§–æ—Ä–º–∞—Ç –∑–∞–Ω—è—Ç–∏–π")
async def handle_format_info(message: Message):
    await add_user_to_db(message.from_user)
    await log_message_to_db(message.from_user, message.text, "menu_button")
    format_text = """üìã –ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–Ω—è—Ç–∏–π?

24 "–∂–∏–≤—ã–µ" –≥—Ä—É–ø–ø–æ–≤—ã–µ –≤—Å—Ç—Ä–µ—á–∏ –æ–Ω–ª–∞–π–Ω. –ó–∞–ø–∏—Å—å –±—É–¥–µ—Ç.

–ì—Ä—É–ø–ø–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–Ω—è—Ç–∏–π:
‚Ä¢ –æ–±–æ–≥–∞—Ç–∏—Ç –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –Ω–æ–≤—ã–º–∏ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º–∏ –∏–¥–µ—è–º–∏
‚Ä¢ –ø–æ–∑–≤–æ–ª–∏—Ç —É—á–∏—Ç—å—Å—è –Ω–∞ —á—É–∂–æ–º –æ–ø—ã—Ç–µ
‚Ä¢ —É–ª—É—á—à–∏—Ç –Ω–∞–≤—ã–∫ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–ª—É—à–∞–Ω–∏—è –∏ –≤–Ω–∏–º–∞–Ω–∏—è –∫ –¥–µ—Ç–∞–ª—è–º

–ü—Ä–∏ —ç—Ç–æ–º –∫–∞–∂–¥—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –ø–æ–ª—É—á–∏—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–∞–º."""

    await message.answer(format_text)

@dp.message(lambda message: message.text == "üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫—É—Ä—Å–∞")
async def handle_results_info(message: Message):
    await add_user_to_db(message.from_user)
    await log_message_to_db(message.from_user, message.text, "menu_button")
    results_text = """üéØ –ß—Ç–æ —Ä–µ–±–µ–Ω–æ–∫ –±—É–¥–µ—Ç –∑–Ω–∞—Ç—å –∏ —É–º–µ—Ç—å –∫ –∫–æ–Ω—Ü—É –∫—É—Ä—Å–∞?

¬´–ú–Ω–µ –Ω–µ –¥–∞–Ω–æ –ø–∏—Å–∞—Ç—å —Å–æ—á–∏–Ω–µ–Ω–∏–µ¬ª, ‚Äî —Ç–∞–∫ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–∫–∞–∂–µ—Ç —É—á–µ–Ω–∏–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å–≤–æ–∏–≤—à–∏–π –≤—Å–µ 9 —Å—Ç—Ä—É–∫—Ç—É—Ä –∫—É—Ä—Å–∞ "–ò–∑–ª–∞–≥–∞–π —è—Å–Ω–æ".

–ù–∞ –∫—É—Ä—Å–µ —É—á–µ–Ω–∏–∫ –Ω–∞—É—á–∏—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–µ–∫—Å—Ç–æ–º, —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ —Ç–µ–∫—Å—Ç–æ–≤, –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—Å—è —Å –ø—Ä–∏–µ–º–∞–º–∏ —É–∫—Ä–∞—à–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏, –∫–æ–Ω–µ—á–Ω–æ, –Ω–∞—É—á–∏—Ç—å—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∏ —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏–∑—É—á–µ–Ω–Ω–æ–µ.

–®–∞–≥ –∑–∞ —à–∞–≥–æ–º –º—ã –ø—Ä–æ–π–¥–µ–º –ø—É—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Å–æ—á–∏–Ω–µ–Ω–∏–π –æ—Ç —Å–∞–º—ã—Ö –ø—Ä–æ—Å—Ç—ã—Ö –¥–æ —Å–ª–æ–∂–Ω—ã—Ö —Ñ–æ—Ä–º, —Å–æ—Å—Ç–æ—è—â–∏—Ö –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–±–∑–∞—Ü–µ–≤.

‚úÖ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç –±—ã—Ç—å –º—É—á–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–≥–∞–¥–∫–æ–π!
‚úÖ –í–∞–º —Å—Ç–∞–Ω–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ, –∞ –≥–ª–∞–≤–Ω–æ–µ –¥–æ—Å—Ç–∏–∂–∏–º–æ –ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç—ã, –¥–∞–∂–µ –µ—Å–ª–∏ —Å–æ–≤—Å–µ–º –Ω–µ—Ç –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è –∏ –º—ã—Å–ª–µ–π, –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞—Ç—å.

üìö 9 —Ä–∞–∑–¥–µ–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —Ä–∞–∑–æ–±—Ä–∞–Ω—ã –Ω–∞ –∫—É—Ä—Å–µ:

1. –ó–∞–º–µ—Ç–∫–∏ –∏ –æ–ø–æ—Ä–Ω–∞—è —Å—Ö–µ–º–∞
2. –û—Ç–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏–∑ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
3. –ü–µ—Ä–µ—Å–∫–∞–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ –æ–ø–æ—Ä–Ω–æ–π —Å—Ö–µ–º–µ
4. –°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
5. –ö—Ä–∞—Ç–∫–æ–µ –ø–∏—Å—å–º–µ–Ω–Ω–æ–µ –∏–∑–ª–æ–∂–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ –æ–ø–æ—Ä–Ω–æ–π —Å—Ö–µ–º–µ
6. –¢–≤–æ—Ä—á–µ—Å–∫–æ–µ –∏–∑–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Ä—Ä–∞—Ç–∏–≤–∞
7. –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ - –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–ª–∞–Ω–∞ –Ω–∞—Ä—Ä–∞—Ç–∏–≤–∞
8. –°–∂–∞—Ç–æ–µ –∏–∑–ª–æ–∂–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–æ–π —Å—Ç–∞—Ç—å–∏
9. –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ - —Ñ–∞–∫—Ç—ã, –æ—Ç–æ–±—Ä–∞–Ω–Ω—ã–µ –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞. –ú–æ–¥–µ–ª—å ¬´—Ç–µ–º–∞ ‚Äî —Å–∫—Ä–µ–ø–∞¬ª

–ò –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ...

–£—á–µ–Ω–∏–∫ –æ–≤–ª–∞–¥–µ–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –∂–∞–Ω—Ä–∞–º–∏ —É—á–µ–±–Ω—ã—Ö –ø–∏—Å—å–º–µ–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤:
‚Ä¢ –∏–∑–ª–æ–∂–µ–Ω–∏–µ–º
‚Ä¢ —Å–æ—á–∏–Ω–µ–Ω–∏–µ–º-–æ–ø–∏—Å–∞–Ω–∏–µ–º
‚Ä¢ —Å–æ—á–∏–Ω–µ–Ω–∏–µ–º-—Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ–º
‚Ä¢ —Å–æ—á–∏–Ω–µ–Ω–∏–µ–º –Ω–∞ —Å–≤–æ–±–æ–¥–Ω—É—é —Ç–µ–º—É
‚Ä¢ –¥–æ–∫–ª–∞–¥–æ–º
‚Ä¢ —Ä–µ—Ñ–µ—Ä–∞—Ç–æ–º
‚Ä¢ —ç—Å—Å–µ, –≤ —Ç–æ–º —á–∏—Å–ª–µ –æ—Ç–∑—ã–≤–æ–º –Ω–∞ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –æ–Ω –Ω–∞—É—á–∏—Ç—Å—è —Ö–æ—Ä–æ—à–æ –ø–æ–Ω–∏–º–∞—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏ –∏ —Å—Ç–∏–ª—è–º–∏ —Ä–µ—á–∏, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Å—Ç–∏–ª—è –∏ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–∞."""

    await message.answer(results_text)

@dp.message(lambda message: message.text == "‚è∞ –ö–∞–∫ –ø—Ä–æ—Ö–æ–¥—è—Ç –∑–∞–Ω—è—Ç–∏—è")
async def handle_schedule_info(message: Message):
    await add_user_to_db(message.from_user)
    await log_message_to_db(message.from_user, message.text, "menu_button")
    schedule_text = """‚è∞ –ö–∞–∫ –ø—Ä–æ—Ö–æ–¥—è—Ç –∑–∞–Ω—è—Ç–∏—è?

üë• –¥–æ 10 —á–µ–ª–æ–≤–µ–∫ –≤ –≥—Ä—É–ø–ø–µ
‚è± 90 –º–∏–Ω —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é
üìÖ –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –∏–ª–∏ —á–µ—Ç–≤–µ—Ä–≥ 10.00 –ø–æ –ú–°–ö (10.00-11.30)
üìÖ –≤ —Å—É–±–±–æ—Ç—É 16.00 –ø–æ –ú–°–ö (16.00-17.30)

üìö –ö–∞–∫–∏–µ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è —É—á–µ–±–Ω–∏–∫–∏
–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ –∫—É—Ä—Å–µ –±—É–¥—É—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–º –≤–∏–¥–µ

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ –∫—É—Ä—Å—É –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ —Å–ª–µ–¥—É—é—â–∏–µ —É—á–µ–±–Ω–∏–∫–∏ (—Å—Å—ã–ª–∫–∏ –Ω–∞ –º–∞–≥–∞–∑–∏–Ω –ö–ë):
‚Ä¢ –°–∏–ª–ª–∞–±—É—Å
‚Ä¢ –£—Ä–æ–∫–∏ —Ä–∞–∑–≤–∏—Ç–∏—è —Ä–µ—á–∏
‚Ä¢ –¢–µ—Ç—Ä–∞–¥—å —É—á–∏—Ç–µ–ª—è
‚Ä¢ –¢–µ—Ç—Ä–∞–¥—å —É—á–µ–Ω–∏–∫–∞
‚Ä¢ "–ü–ª–∞–∫–∞—Ç—ã –≤ –º–∏–Ω–∏–∞—Ç—é—Ä–µ"

üìñ –ß—Ç–æ –±—É–¥–µ—Ç –Ω–∞ –∑–∞–Ω—è—Ç–∏—è—Ö:
‚Ä¢ —á—Ç–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤, –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ä–µ–±—è—Ç–∞–º–∏ –∑–∞ –Ω–µ–¥–µ–ª—é
‚Ä¢ –ø–æ–≤—Ç–æ—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —É—Ä–æ–∫–æ–≤
‚Ä¢ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞
‚Ä¢ –∏–∑—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
‚Ä¢ —á—Ç–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ –Ω–µ–º—É –æ–ø–æ—Ä–Ω–æ–π —Å—Ö–µ–º—ã –∏ –ø–µ—Ä–µ—Å–∫–∞–∑ —Ç–µ–∫—Å—Ç–∞ –ø–æ –æ–ø–æ—Ä–Ω—ã–º —Å–ª–æ–≤–∞–º
‚Ä¢ —Ä–∞–∑–±–æ—Ä –Ω–æ–≤–æ–π —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Ç–µ—Ö–Ω–∏–∫–∏ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –Ω–∞ –Ω–æ–≤—É—é –∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Ö–Ω–∏–∫
‚Ä¢ —Ä–∞–±–æ—Ç–∞ —Å —Ä–µ–¥–∫–∏–º–∏ —Å–ª–æ–≤–∞–º–∏

üè† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ –¥–æ–º–∞?
–ö–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é –∑–∞–¥–∞–Ω–∏–µ - –Ω–∞–ø–∏—Å–∞—Ç—å —Å–æ—á–∏–Ω–µ–Ω–∏–µ –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–∑—É—á–µ–Ω–Ω—ã—Ö —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Ö–Ω–∏–∫

–î–µ–Ω—å 1 (–¥–µ–Ω—å –∑–∞–Ω—è—Ç–∏—è): –°–æ—Å—Ç–∞–≤–∏—Ç—å –æ–ø–æ—Ä–Ω—É—é —Å—Ö–µ–º—É.
–î–µ–Ω—å 2: –ü–µ—Ä–µ—Å–∫–∞–∑–∞—Ç—å —Ç–µ–∫—Å—Ç –ø–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –æ–ø–æ—Ä–Ω–æ–π —Å—Ö–µ–º–µ. –ù–∞–ø–∏—Å–∞—Ç—å –ø–µ—Ä–≤—É—é —Ä—É–∫–æ–ø–∏—Å—å –ø–æ –æ–ø–æ—Ä–Ω–æ–π —Å—Ö–µ–º–µ.
–î–µ–Ω—å 3: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä—É–∫–æ–ø–∏—Å—å –∏ –≤–Ω–µ—Å—Ç–∏ –≤ —Ç–µ–∫—Å—Ç –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –∫–∞—Ä—Ç—ã –∫–æ–Ω—Ç—Ä–æ–ª—è.
–î–µ–Ω—å 4: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞—á–∏—Å—Ç–æ, –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –¥–æ–±–∞–≤–∏—Ç—å –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—é.

üéØ –ù–∞ —á–µ–º —Ñ–æ–∫—É—Å –∫—É—Ä—Å–∞?
‚Ä¢ –Ω–∞ —Ç–æ–º –ö–ê–ö –ø–∏—Å–∞—Ç—å, –∞ –Ω–µ —á—Ç–æ –ø–∏—Å–∞—Ç—å
‚Ä¢ –Ω–∞ —Ç–µ–∫—Å—Ç–∞—Ö, —Å—Ç—Ä—É–∫—Ç—É—Ä–µ, —Å—Ç–∏–ª–µ, –∞ –Ω–µ –Ω–∞ –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏
‚Ä¢ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–≤–æ–¥—è—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è —Å —Ä–∞–∑–±–æ—Ä–æ–º –æ—à–∏–±–æ–∫

üè∞ –£—Ä–æ–∫–∏ —Ä–∞–∑–≤–∏—Ç–∏—è —Ä–µ—á–∏ –∫—É—Ä—Å–∞ "–ò–∑–ª–∞–≥–∞–π —è—Å–Ω–æ" –≤ —ç—Ç–æ–º –≥–æ–¥—É –ø–æ—Å–≤—è—â–µ–Ω—ã –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å—é. –°–æ–≤–º–µ—Å—Ç–∏–º —Å–ª–æ–≤–µ—Å–Ω–æ—Å—Ç—å –∏ –∏—Å—Ç–æ—Ä–∏—é."""

    await message.answer(schedule_text)

@dp.message(lambda message: message.text == "üí∞ –û–ø–ª–∞—Ç–∞")
async def handle_payment_info(message: Message):
    await add_user_to_db(message.from_user)
    await log_message_to_db(message.from_user, message.text, "menu_button")
    payment_text = f"""üí∞ –ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å?

üí≥ –û–ø–ª–∞—Ç–∞:
‚Ä¢ –±–ª–æ–∫–∞–º–∏ –ø–æ 6 –∑–∞–Ω—è—Ç–∏–π - 7200 —Ä
‚Ä¢ –≤—Å–µ–≥–æ 4 –±–ª–æ–∫–∞ –ø–æ 7200 —Ä –∫–∞–∂–¥—ã–π –±–ª–æ–∫
‚Ä¢ –ø–æ–ª–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫—É—Ä—Å–∞ 28800 —Ä

‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!
–ü–æ –ø–æ–≤–æ–¥—É –æ–ø–ª–∞—Ç—ã –∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ –æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å –ª–∏—á–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –≤–µ–¥—É—â–µ–≥–æ: {ELENA_CONTACT}

üí≥ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç—É –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–∞ –°–±–µ—Ä
üì± –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –Ω—É–∂–Ω–æ –ø—Ä–∏—Å–ª–∞—Ç—å —Å–∫—Ä–∏–Ω –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
üßæ –í–∞–º –±—É–¥–µ—Ç –≤—ã—Å–ª–∞–Ω —á–µ–∫ –æ–± –æ–ø–ª–∞—Ç–µ.

üìÑ –î–æ–≥–æ–≤–æ—Ä –æ—Ñ–µ—Ä—Ç—ã
–î–æ–≥–æ–≤–æ—Ä –æ—Ñ–µ—Ä—Ç—ã —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Å–ª–æ–≤–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥ –ø–æ –∫—É—Ä—Å—É "–ò–∑–ª–∞–≥–∞–π —è—Å–Ω–æ".

‚ö†Ô∏è –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∞ –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π –∫—É—Ä—Å–∞.

üìû –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤–µ–¥—É—â–µ–º—É –∫—É—Ä—Å–∞."""

    await message.answer(payment_text)


@dp.message(lambda message: message.text == "üÜò –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π")
async def handle_support_button(message: Message, state: FSMContext):
    await add_user_to_db(message.from_user)
    await log_message_to_db(message.from_user, message.text, "menu_button")
    support_text = """üÜò –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π

–û–ø–∏—à–∏—Ç–µ –∫—Ä–∞—Ç–∫–æ –≤–∞—à –≤–æ–ø—Ä–æ—Å, –∏ –º—ã –æ—Ç–≤–µ—Ç–∏–º –≤–∞–º —Å—Ä–∞–∑—É, –∫–∞–∫ —Ç–æ–ª—å–∫–æ —Å–º–æ–∂–µ–º!

–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º:"""

    await message.answer(support_text)
    await state.set_state(SupportStates.waiting_for_question)

@dp.callback_query(lambda c: c.data == "support")
async def process_support_callback(callback_query: types.CallbackQuery, state: FSMContext):
    await callback_query.answer()

    support_text = """üÜò –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π

–û–ø–∏—à–∏—Ç–µ –∫—Ä–∞—Ç–∫–æ –≤–∞—à –≤–æ–ø—Ä–æ—Å, –∏ –º—ã –æ—Ç–≤–µ—Ç–∏–º –≤–∞–º —Å—Ä–∞–∑—É, –∫–∞–∫ —Ç–æ–ª—å–∫–æ —Å–º–æ–∂–µ–º!

–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º:"""

    await callback_query.message.answer(support_text)
    await state.set_state(SupportStates.waiting_for_question)

@dp.message(SupportStates.waiting_for_question)
async def process_support_question(message: Message, state: FSMContext):
    # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
    await add_user_to_db(message.from_user)
    # –õ–æ–≥–∏—Ä—É–µ–º –≤–æ–ø—Ä–æ—Å –ø–æ–¥–¥–µ—Ä–∂–∫–∏
    await log_message_to_db(message.from_user, message.text, "support_question")

    user_question = message.text
    user_info = f"@{message.from_user.username}" if message.from_user.username else f"ID: {message.from_user.id}"
    user_name = message.from_user.full_name

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤–æ–ø—Ä–æ—Å –ï–ª–µ–Ω–µ
    support_message = f"""üÜò –ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–æ—Ç–∞:

üë§ –û—Ç: {user_name} ({user_info})
üìù –í–æ–ø—Ä–æ—Å: {user_question}

–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {message.date.strftime('%d.%m.%Y %H:%M')}"""

    try:
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
        await bot.send_message(chat_id=ADMIN_CHAT_ID, text=support_message)

        confirmation_text = f"""‚úÖ –í–∞—à –≤–æ–ø—Ä–æ—Å –ø–æ–ª—É—á–µ–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤–µ–¥—É—â–µ–º—É –∫—É—Ä—Å–∞!

üìù –í–æ–ø—Ä–æ—Å: {user_question}

üë§ –û—Ç: {user_name} ({user_info})

‚è∞ –ï–ª–µ–Ω–∞ –æ—Ç–≤–µ—Ç–∏—Ç –≤–∞–º –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è!

üìû –î–ª—è —Å—Ä–æ—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –Ω–∞–ø—Ä—è–º—É—é: {ELENA_CONTACT}"""

    except Exception as e:
        logging.error(f"Failed to send message to admin: {e}")
        confirmation_text = f"""‚úÖ –í–∞—à –≤–æ–ø—Ä–æ—Å –ø–æ–ª—É—á–µ–Ω!

üìù –í–æ–ø—Ä–æ—Å: {user_question}

üë§ –û—Ç: {user_name} ({user_info})

‚ö†Ô∏è –í–æ–∑–Ω–∏–∫–ª–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π.
üìû –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –Ω–∞–ø—Ä—è–º—É—é –∫ –≤–µ–¥—É—â–µ–º—É –∫—É—Ä—Å–∞: {ELENA_CONTACT}"""

    await message.answer(confirmation_text)
    await state.clear()

@dp.message()
async def handle_other_messages(message: Message):
    # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
    await add_user_to_db(message.from_user)
    # –õ–æ–≥–∏—Ä—É–µ–º –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    await log_message_to_db(message.from_user, message.text, "other_message")

    help_text = f"""‚ùì –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –±–æ—Ç—É –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∑–∞ –ø–æ–º–æ—â—å—é –∫ –≤–µ–¥—É—â–µ–º—É –∫—É—Ä—Å–∞: {ELENA_CONTACT}"""
    await message.answer(help_text, reply_markup=get_main_keyboard())

async def main():
    logging.basicConfig(level=logging.INFO)

    # –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–æ—É—Ç–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–æ–≤
    dp.include_router(test_router)

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    await init_database()

    await dp.start_polling(bot)

if __name__ == '__main__':
    asyncio.run(main())